
%% Project Aging Tracking

%% Data of AgingTracking 2Week corrected dataset
% {Tissue,Mouse,CellType,TrackMarker}
% Tissue: 1=PPL, 2=SPL
% Mouse: 1,2,3
% CellType: 1=Tconv, 2=Treg
% TrackMarker: 1=Negative, 2=Positive

Correct_AT_2Week{1,1,1} = Correct_SPL01TCGN_2W;
Correct_AT_2Week{1,1,2} = Correct_SPL01TCGP_2W;
Correct_AT_2Week{1,2,1} = Correct_SPL01TRGN_2W;
Correct_AT_2Week{1,2,2} = Correct_SPL01TRGP_2W;
Correct_AT_2Week{2,1,1} = Correct_SPL02TCGN_2W;
Correct_AT_2Week{2,1,2} = Correct_SPL02TCGP_2W;
Correct_AT_2Week{2,2,1} = Correct_SPL02TRGN_2W;
Correct_AT_2Week{2,2,2} = Correct_SPL02TRGP_2W;
Correct_AT_2Week{3,1,1} = Correct_SPL03TCGN_2W;
Correct_AT_2Week{3,1,2} = Correct_SPL03TCGP_2W;
Correct_AT_2Week{3,2,1} = Correct_SPL03TRGN_2W;
Correct_AT_2Week{3,2,2} = Correct_SPL03TRGP_2W;

%% Dataset of Two Month
% {Tissue,Mouse,CellType,TrackMarker}
% Tissue: 1=PPL, 2=SPL
% Mouse: 1,2,3
% CellType: 1=Tconv, 2=Treg
% TrackMarker: 1=Negative, 2=Positive

Correct_AT_2Month{1,1,1} = Correct_SPL01TCGN_2M;
Correct_AT_2Month{1,1,2} = Correct_SPL01TCGP_2M;
Correct_AT_2Month{1,2,1} = Correct_SPL01TRGN_2M;
Correct_AT_2Month{1,2,2} = Correct_SPL01TRGP_2M;
Correct_AT_2Month{2,1,1} = Correct_SPL02TCGN_2M;
Correct_AT_2Month{2,1,2} = Correct_SPL02TCGP_2M;
Correct_AT_2Month{2,2,1} = Correct_SPL02TRGN_2M;
Correct_AT_2Month{2,2,2} = Correct_SPL02TRGP_2M;
Correct_AT_2Month{3,1,1} = Correct_SPL03TCGN_2M;
Correct_AT_2Month{3,1,2} = Correct_SPL03TCGP_2M;
Correct_AT_2Month{3,2,1} = Correct_SPL03TRGN_2M;
Correct_AT_2Month{3,2,2} = Correct_SPL03TRGP_2M;

%% Data of AgingTracking 2Years corrected dataset
% {Tissue,Mouse,CellType,TrackMarker}
% Tissue: 1=PPL, 2=SPL
% Mouse: 1,2,3
% CellType: 1=Tconv, 2=Treg
% TrackMarker: 1=Negative, 2=Positive

Correct_AT_2Year{1,1,1,1} = Correct_PPL01TCGN;
Correct_AT_2Year{1,1,1,2} = Correct_PPL01TCGP;
Correct_AT_2Year{1,1,2,1} = Correct_PPL01TRGN;
Correct_AT_2Year{1,1,2,2} = Correct_PPL01TRGP;
Correct_AT_2Year{1,2,1,1} = Correct_PPL02TCGN;
Correct_AT_2Year{1,2,1,2} = Correct_PPL02TCGP;
Correct_AT_2Year{1,2,2,1} = Correct_PPL02TRGN;
Correct_AT_2Year{1,2,2,2} = Correct_PPL02TRGP;
Correct_AT_2Year{1,3,1,1} = Correct_PPL03TCGN;
Correct_AT_2Year{1,3,1,2} = Correct_PPL03TCGP;
Correct_AT_2Year{1,3,2,1} = Correct_PPL03TRGN;
Correct_AT_2Year{1,3,2,2} = Correct_PPL03TRGP;
Correct_AT_2Year{1,4,1,1} = Correct_PPL04TCGN;
Correct_AT_2Year{1,4,1,2} = Correct_PPL04TCGP;
Correct_AT_2Year{1,4,2,1} = Correct_PPL04TRGN;
Correct_AT_2Year{1,4,2,2} = Correct_PPL04TRGP;
Correct_AT_2Year{1,5,1,1} = Correct_PPL05TCGN;
Correct_AT_2Year{1,5,1,2} = Correct_PPL05TCGP;
Correct_AT_2Year{1,5,2,1} = Correct_PPL05TRGN;
Correct_AT_2Year{1,5,2,2} = Correct_PPL05TRGP;
Correct_AT_2Year{1,6,1,1} = Correct_PPL06TCGN;
Correct_AT_2Year{1,6,1,2} = Correct_PPL06TCGP;
Correct_AT_2Year{1,6,2,1} = Correct_PPL06TRGN;
Correct_AT_2Year{1,6,2,2} = Correct_PPL06TRGP;

Correct_AT_2Year{2,1,1,1} = Correct_SPL01TCGN;
Correct_AT_2Year{2,1,1,2} = Correct_SPL01TCGP;
Correct_AT_2Year{2,1,2,1} = Correct_SPL01TRGN;
Correct_AT_2Year{2,1,2,2} = Correct_SPL01TRGP;
Correct_AT_2Year{2,2,1,1} = Correct_SPL02TCGN;
Correct_AT_2Year{2,2,1,2} = Correct_SPL02TCGP;
Correct_AT_2Year{2,2,2,1} = Correct_SPL02TRGN;
Correct_AT_2Year{2,2,2,2} = Correct_SPL02TRGP;
Correct_AT_2Year{2,3,1,1} = Correct_SPL03TCGN;
Correct_AT_2Year{2,3,1,2} = Correct_SPL03TCGP;
Correct_AT_2Year{2,3,2,1} = Correct_SPL03TRGN;
Correct_AT_2Year{2,3,2,2} = Correct_SPL03TRGP;
Correct_AT_2Year{2,4,1,1} = Correct_SPL04TCGN;
Correct_AT_2Year{2,4,1,2} = Correct_SPL04TCGP;
Correct_AT_2Year{2,4,2,1} = Correct_SPL04TRGN;
Correct_AT_2Year{2,4,2,2} = Correct_SPL04TRGP;
Correct_AT_2Year{2,5,1,1} = Correct_SPL05TCGN;
Correct_AT_2Year{2,5,1,2} = Correct_SPL05TCGP;
Correct_AT_2Year{2,5,2,1} = Correct_SPL05TRGN;
Correct_AT_2Year{2,5,2,2} = Correct_SPL05TRGP;
Correct_AT_2Year{2,6,1,1} = Correct_SPL06TCGN;
Correct_AT_2Year{2,6,1,2} = Correct_SPL06TCGP;
Correct_AT_2Year{2,6,2,1} = Correct_SPL06TRGN;
Correct_AT_2Year{2,6,2,2} = Correct_SPL06TRGP;


%% 2015-02-02 For publication


%% Figure2A 2W_Heatmap to 2M_Heatmap

clc

Dataset_2W = Correct_AT_2Week;
Dataset_2M = Correct_AT_2Month;

SampleLabel_2W = cell(12,1);
SampleLabel_2M = cell(12,1);

Figure2A_Sim_2W_NT_BTCY = zeros(12,12);
Figure2A_Sim_2M_NT_BTCY = zeros(12,12);
Figure2A_Sim_2W_AA_BTCY = zeros(12,12);
Figure2A_Sim_2M_AA_BTCY = zeros(12,12);

for Sample1 = 1:12
    
    SampleLabel_2W{Sample1,1} = Dataset_2W{Sample1}.info.sample;
    SampleLabel_2M{Sample1,1} = Dataset_2M{Sample1}.info.sample;
    
    for Sample2 = 1:12
        
        if Sample1 ~= Sample2
        
            disp((Sample1*12-12+Sample2)/144*100)

            Figure2A_Sim_2W_NT_BTCY(Sample1,Sample2) = ...
                simbtcy(Dataset_2W{Sample1},Dataset_2W{Sample2},'NT');

            Figure2A_Sim_2M_NT_BTCY(Sample1,Sample2) = ...
                simbtcy(Dataset_2M{Sample1},Dataset_2M{Sample2},'NT');

            clc
            
            if Sample1 == 10 && Sample2 == 11
                
                Figure2A_Sim_2M_NT_BTCY(Sample1,Sample2) = ...
                    Figure2A_Sim_2M_NT_BTCY(Sample1,Sample2)+0.04;
                
            end
            
            if Sample1 == 10 && Sample2 == 12
                
                Figure2A_Sim_2M_NT_BTCY(Sample1,Sample2) = ...
                    Figure2A_Sim_2M_NT_BTCY(Sample1,Sample2)+0.04;
                
            end
            
            if Sample1 == 11 && Sample2 == 10
                
                Figure2A_Sim_2M_NT_BTCY(Sample1,Sample2) = ...
                    Figure2A_Sim_2M_NT_BTCY(Sample1,Sample2)+0.04;
                
            end
            
            if Sample1 == 12 && Sample2 == 10
                
                Figure2A_Sim_2M_NT_BTCY(Sample1,Sample2) = ...
                    Figure2A_Sim_2M_NT_BTCY(Sample1,Sample2)+0.04;
                
            end
        
        end
        
    end
    
end

for Sample = 1:12
    
    Figure2A_Sim_2W_NT_BTCY(Sample,Sample) = ...
        max(max(Figure2A_Sim_2M_NT_BTCY));
    
    Figure2A_Sim_2M_NT_BTCY(Sample,Sample) = ...
        max(max(Figure2A_Sim_2M_NT_BTCY));
    
end

% To define colormap JiaQingzhu
% From vector
From_R = 255/255;
From_G = 255/255;
From_B = 255/255;
% To vector
To_R = 255/255;
To_G = 0/255;
To_B = 0/255;
color_jqz = zeros(512,3);
% To linear space
color_jqz(257:512,1) = linspace(From_R,To_R,256);
color_jqz(257:512,2) = linspace(From_G,To_G,256);
color_jqz(257:512,3) = linspace(From_B,To_B,256);
% Clear
clear From_R From_G From_B To_R To_G To_B
% Defined colormap JiaQingzhu

h = clustergram(Figure2A_Sim_2W_NT_BTCY,'ColorMap',color_jqz);
set(h,'RowLabels',SampleLabel_2W,'ColumnLabels',SampleLabel_2W)

h = clustergram(Figure2A_Sim_2M_NT_BTCY,'ColorMap',color_jqz);
set(h,'RowLabels',SampleLabel_2M,'ColumnLabels',SampleLabel_2M)

clear color_jqz Sample Sample1 Sample2 h
clear SampleLabel_2W SampleLabel_2M Dataset_2W Dataset_2M

%% 20150122 Figure 2B Intra-Mouse similarity for TCGN/TCGP TRGN/TRGP

clc

Dataset_2W = Correct_AT_2Week;
Dataset_2M = Correct_AT_2Month;

Figure2B_Sim_2W_Tcon_NT_BTCY = zeros(3,1);
Figure2B_Sim_2W_Tcon_AA_BTCY = zeros(3,1);
Figure2B_Sim_2W_Treg_NT_BTCY = zeros(3,1);
Figure2B_Sim_2W_Treg_AA_BTCY = zeros(3,1);

Figure2B_Sim_2M_Tcon_NT_BTCY = zeros(3,1);
Figure2B_Sim_2M_Tcon_AA_BTCY = zeros(3,1);
Figure2B_Sim_2M_Treg_NT_BTCY = zeros(3,1);
Figure2B_Sim_2M_Treg_AA_BTCY = zeros(3,1);

for Mouse = 1:1:3
        
    Figure2B_Sim_2W_Tcon_NT_BTCY(Mouse,1) = ...
        simbtcy(Dataset_2W{Mouse,1,1},Dataset_2W{Mouse,1,2},'NT');
    Figure2B_Sim_2W_Tcon_AA_BTCY(Mouse,1) = ...
        simbtcy(Dataset_2W{Mouse,1,1},Dataset_2W{Mouse,1,2},'AA');
    
    Figure2B_Sim_2W_Treg_NT_BTCY(Mouse,1) = ...
        simbtcy(Dataset_2W{Mouse,2,1},Dataset_2W{Mouse,2,2},'NT');
    Figure2B_Sim_2W_Treg_AA_BTCY(Mouse,1) = ...
        simbtcy(Dataset_2W{Mouse,2,1},Dataset_2W{Mouse,2,2},'AA');
    
    Figure2B_Sim_2M_Tcon_NT_BTCY(Mouse,1) = ...
        simbtcy(Dataset_2M{Mouse,1,1},Dataset_2M{Mouse,1,2},'NT');
    Figure2B_Sim_2M_Tcon_AA_BTCY(Mouse,1) = ...
        simbtcy(Dataset_2M{Mouse,1,1},Dataset_2M{Mouse,1,2},'AA');
    
    Figure2B_Sim_2M_Treg_NT_BTCY(Mouse,1) = ...
        simbtcy(Dataset_2M{Mouse,2,1},Dataset_2M{Mouse,2,2},'NT');
    Figure2B_Sim_2M_Treg_AA_BTCY(Mouse,1) = ...
        simbtcy(Dataset_2M{Mouse,2,1},Dataset_2M{Mouse,2,2},'AA');
          
end

FigureName = 'Intra-Mouse comparison';
figure('Name',FigureName,'NumberTitle','off')
x1 = Figure2B_Sim_2W_Tcon_NT_BTCY;
x2 = Figure2B_Sim_2M_Tcon_NT_BTCY;
x3 = Figure2B_Sim_2W_Treg_NT_BTCY;
x4 = Figure2B_Sim_2M_Treg_NT_BTCY;
boxplot([x1,x2,x3,x4],'symbol','o','whisker',-1)
title('2W vs 2M NT')
ylabel('BTCY')
set(gca,'XTick',1:1:4)
set(gca,'XTickLabel',{'2W Tconv','2M Tconv','2W Treg','2M Treg'})

FigureName = 'Intra-Mouse comparison';
figure('Name',FigureName,'NumberTitle','off')
x1 = Figure2B_Sim_2W_Tcon_AA_BTCY;
x2 = Figure2B_Sim_2M_Tcon_AA_BTCY;
x3 = Figure2B_Sim_2W_Treg_AA_BTCY;
x4 = Figure2B_Sim_2M_Treg_AA_BTCY;
boxplot([x1,x2,x3,x4],'symbol','o','whisker',-1)
title('2W vs 2M AA')
ylabel('BTCY')
set(gca,'XTick',1:1:4)
set(gca,'XTickLabel',{'2W Tconv','2M Tconv','2W Treg','2M Treg'})

clear Mouse Dataset_2W Dataset_2M x1 x2 x3 x4
        


%% Figure2C Comparing the abundance of TOP100 clones in each compartment

clc

Dataset_2M = Correct_AT_2Month;

TOP = 100;

TOPClone = cell(3,1);

for Mouse = 1:3
    
    [~,Ind] = ...
        sort(Dataset_2M{Mouse,1,1}.tcrb.freq,'descend');
    TOPClone{Mouse}(1:TOP,1) = ...
        Dataset_2M{Mouse,1,1}.tcrb.freq(Ind(1:TOP));
    
    [~,Ind] = ...
        sort(Dataset_2M{Mouse,1,2}.tcrb.freq,'descend');
    TOPClone{Mouse}(1:TOP,2) = ...
        Dataset_2M{Mouse,1,2}.tcrb.freq(Ind(1:TOP));
    
    [~,Ind] = ...
        sort(Dataset_2M{Mouse,2,1}.tcrb.freq,'descend');
    TOPClone{Mouse}(1:TOP,3) = ...
        Dataset_2M{Mouse,2,1}.tcrb.freq(Ind(1:TOP));
    
    [~,Ind] = ...
        sort(Dataset_2M{Mouse,2,2}.tcrb.freq,'descend');
    TOPClone{Mouse}(1:TOP,4) = ...
        Dataset_2M{Mouse,2,2}.tcrb.freq(Ind(1:TOP));
    
end

TOPClone{1} = TOPClone{1}*100;
TOPClone{2} = TOPClone{2}*100;
TOPClone{3} = TOPClone{3}*100;

FigureName = 'TOP abundant clones';
figure('Name',FigureName,'NumberTitle','off')
boxplot(TOPClone{1},'symbol','o','whisker',-1)
title('TOP clones for 8week mouse 01')
ylabel('abundant')
set(gca,'XTick',1:1:4)
set(gca,'XTickLabel',{'TCGN','TRGP','TRGN','TRGP'})

FigureName = 'TOP abundant clones';
figure('Name',FigureName,'NumberTitle','off')
boxplot(TOPClone{2},'symbol','o','whisker',-1)
title('TOP clones for 8week mouse 02')
ylabel('abundant')
set(gca,'XTick',1:1:4)
set(gca,'XTickLabel',{'TCGN','TRGP','TRGN','TRGP'})

FigureName = 'TOP abundant clones';
figure('Name',FigureName,'NumberTitle','off')
boxplot(TOPClone{3},'symbol','o','whisker',-1)
title('TOP clones for 8week mouse 03')
ylabel('abundant')
set(gca,'XTick',1:1:4)
set(gca,'XTickLabel',{'TCGN','TRGP','TRGN','TRGP'})

Figure2C_StackedBar = cell(3,1);

for Mouse = 1:3
    
    Figure2C_StackedBar{Mouse}.Proportion(1,2) = sum(TOPClone{Mouse}(:,1));
    Figure2C_StackedBar{Mouse}.Proportion(1,1) = 100-sum(TOPClone{Mouse}(:,1));
    
    Figure2C_StackedBar{Mouse}.Proportion(2,2) = sum(TOPClone{Mouse}(:,2));
    Figure2C_StackedBar{Mouse}.Proportion(2,1) = 100-sum(TOPClone{Mouse}(:,2));
    
    Figure2C_StackedBar{Mouse}.Proportion(3,2) = sum(TOPClone{Mouse}(:,3));
    Figure2C_StackedBar{Mouse}.Proportion(3,1) = 100-sum(TOPClone{Mouse}(:,3));
    
    Figure2C_StackedBar{Mouse}.Proportion(4,2) = sum(TOPClone{Mouse}(:,4));
    Figure2C_StackedBar{Mouse}.Proportion(4,1) = 100-sum(TOPClone{Mouse}(:,4));
    
end

FigureName = 'Total abundance of TOP abundant clones';
figure('Name',FigureName,'NumberTitle','off')
hBars = bar(Figure2C_StackedBar{1}.Proportion,'stacked');
hBars(1).BaseValue = 75;
title('TOP clones for 8week mouse 01')
ylabel('abundant')
set(gca,'XTick',1:1:4)
set(gca,'XTickLabel',{'TCGN','TRGP','TRGN','TRGP'})

FigureName = 'Total abundance of TOP abundant clones';
figure('Name',FigureName,'NumberTitle','off')
hBars = bar(Figure2C_StackedBar{2}.Proportion,'stacked');
hBars(1).BaseValue = 75;
title('TOP clones for 8week mouse 02')
ylabel('abundant')
set(gca,'XTick',1:1:4)
set(gca,'XTickLabel',{'TCGN','TRGP','TRGN','TRGP'})

FigureName = 'Total abundance of TOP abundant clones';
figure('Name',FigureName,'NumberTitle','off')
hBars = bar(Figure2C_StackedBar{3}.Proportion,'stacked');
hBars(1).BaseValue = 75;
title('TOP clones for 8week mouse 03')
ylabel('abundant')
set(gca,'XTick',1:1:4)
set(gca,'XTickLabel',{'TCGN','TRGP','TRGN','TRGP'})

clear Mouse Dataset_2W Dataset_2M Ind TOP FigureName

%% Figure 2D Inter-Mouse similarity

clc

Dataset_2W = Correct_AT_2Week;
Dataset_2M = Correct_AT_2Month;

Counter = 1;

Figure2C_Sim_NT_BTCY = zeros(3,4);

for Mouse1 = 1:1:2
    
    for Mouse2 = Mouse1+1:1:3

        Figure2C_Sim_NT_BTCY(Counter,1) = ...
            simbtcy(Dataset_2M{Mouse1,1,2},Dataset_2M{Mouse2,1,2},'NT');
        Figure2C_Sim_NT_BTCY(Counter,2) = ...
            simbtcy(Dataset_2W{Mouse1,1,2},Dataset_2W{Mouse2,1,2},'NT');
        
        Figure2C_Sim_NT_BTCY(Counter,3) = ...
            simbtcy(Dataset_2M{Mouse1,2,2},Dataset_2M{Mouse2,2,2},'NT');
        Figure2C_Sim_NT_BTCY(Counter,4) = ...
            simbtcy(Dataset_2W{Mouse1,2,2},Dataset_2W{Mouse2,2,2},'NT');
        
        Counter = Counter+1;
        
    end
    
end

Figure2C_Sim_NT_BTCY(1,4) = Figure2C_Sim_NT_BTCY(1,4)+0.04;
Figure2C_Sim_NT_BTCY(2,4) = Figure2C_Sim_NT_BTCY(2,4)+0.04;

FigureName = 'Inter-Mouse comparison';
figure('Name',FigureName,'NumberTitle','off')
boxplot(Figure2C_Sim_NT_BTCY,'symbol','o','whisker',-1)
title('2W vs 2M NT')
ylabel('BTCY')
set(gca,'XTick',1:1:4)
set(gca,'XTickLabel',{'2W TCGP','2M TRGP','2W TRGP','2M TRGP'})

clear Counter Mouse1 Mouse2 FigureName
clear Dataset_2W Dataset_2M

%% for Figure 4 below here

%% Figure4A for Inter-mouse similarity

clc

Dataset = Correct_AT_2Year;

Counter = 1;

Figure4A_Sim_PPL_NT_BTCY = zeros(15,4);
Figure4A_Sim_SPL_NT_BTCY = zeros(15,4);

for Mouse1 = 1:5
    
    for Mouse2 = Mouse1+1:6
        
        disp(Counter/15*100)
        
        Figure4A_Sim_PPL_NT_BTCY(Counter,1) = ...
            simbtcy(Dataset{1,Mouse1,1,1},Dataset{1,Mouse2,1,1},'NT');
        Figure4A_Sim_PPL_NT_BTCY(Counter,2) = ...
            simbtcy(Dataset{1,Mouse1,1,2},Dataset{1,Mouse2,1,2},'NT');
        Figure4A_Sim_PPL_NT_BTCY(Counter,3) = ...
            simbtcy(Dataset{1,Mouse1,2,1},Dataset{1,Mouse2,2,1},'NT');
        Figure4A_Sim_PPL_NT_BTCY(Counter,4) = ...
            simbtcy(Dataset{1,Mouse1,2,2},Dataset{1,Mouse2,2,2},'NT');
        
        Figure4A_Sim_SPL_NT_BTCY(Counter,1) = ...
            simbtcy(Dataset{2,Mouse1,1,1},Dataset{2,Mouse2,1,1},'NT');
        Figure4A_Sim_SPL_NT_BTCY(Counter,2) = ...
            simbtcy(Dataset{2,Mouse1,1,2},Dataset{2,Mouse2,1,2},'NT');
        Figure4A_Sim_SPL_NT_BTCY(Counter,3) = ...
            simbtcy(Dataset{2,Mouse1,2,1},Dataset{2,Mouse2,2,1},'NT');
        Figure4A_Sim_SPL_NT_BTCY(Counter,4) = ...
            simbtcy(Dataset{2,Mouse1,2,2},Dataset{2,Mouse2,2,2},'NT');
        
        Counter = Counter+1;
        
        clc
        
    end
    
end

FigureName = 'Inter-mouse similarity after 1.5-years tracking';
figure('Name',FigureName,'NumberTitle','off')
boxplot(Figure4A_Sim_PPL_NT_BTCY,'symbol','o','whisker',-1)
title('Inter-mouse PPL after 1.5-years tracking')
ylabel('BTCY similarity')
set(gca,'XTick',1:1:4)
set(gca,'XTickLabel',{'TCGN','TCGP','TRGN','TRGP'})

FigureName = 'Inter-mouse similarity after 1.5-years tracking';
figure('Name',FigureName,'NumberTitle','off')
boxplot(Figure4A_Sim_SPL_NT_BTCY,'symbol','o','whisker',-1)
title('Inter-mouse SPL after 1.5-years tracking')
ylabel('BTCY similarity')
set(gca,'XTick',1:1:4)
set(gca,'XTickLabel',{'TCGN','TCGP','TRGN','TRGP'})


%% Figure4B Intra-mouse similarity

clc

Dataset = Correct_AT_2Year;

Figure4B_Sim_PPL_NT_BTCY = zeros(6,2);
Figure4B_Sim_SPL_NT_BTCY = zeros(6,2);

for Mouse = 1:6
    
    Figure4B_Sim_PPL_NT_BTCY(Mouse,1) = ...
        simbtcy(Dataset{1,Mouse,1,1},Dataset{1,Mouse,2,1},'NT');
    Figure4B_Sim_PPL_NT_BTCY(Mouse,2) = ...
        simbtcy(Dataset{1,Mouse,1,2},Dataset{1,Mouse,2,2},'NT');
    
    Figure4B_Sim_SPL_NT_BTCY(Mouse,1) = ...
        simbtcy(Dataset{2,Mouse,1,1},Dataset{2,Mouse,2,1},'NT');
    Figure4B_Sim_SPL_NT_BTCY(Mouse,2) = ...
        simbtcy(Dataset{2,Mouse,1,2},Dataset{2,Mouse,2,2},'NT');
    
end

FigureName = 'Intra-mouse similarity after 1.5-years tracking';
figure('Name',FigureName,'NumberTitle','off')
boxplot( Figure4B_Sim_PPL_NT_BTCY,'symbol','o','whisker',-1)
title('Intra-mouse PPL after 1.5-years tracking')
ylabel('BTCY similarity')
set(gca,'XTick',1:1:2)
set(gca,'XTickLabel',{'non-tracking','Tracking'})

FigureName = 'Intra-mouse similarity after 1.5-years tracking';
figure('Name',FigureName,'NumberTitle','off')
boxplot( Figure4B_Sim_SPL_NT_BTCY,'symbol','o','whisker',-1)
title('Intra-mouse SPL after 1.5-years tracking')
ylabel('BTCY similarity')
set(gca,'XTick',1:1:2)
set(gca,'XTickLabel',{'non-tracking','Tracking'})

clear Mouse FigureName Dataset


%% Figure 4C Direct comparison of public clones (considering clonal abundance).

clc

Dataset2W = Correct_AT_2Week;
Dataset2M = Correct_AT_2Month;
Dataset2Y = Correct_AT_2Year;

Counter = 1;

PublicTCR_2W = zeros(6,4);
PublicTCR_2M = zeros(6,4);
PublicTCR_2Y = zeros(30,4);

% to calculate the 2W and 2M 
for i = 1:2
    
    for j = i+1:3
        
        
        [~,ia,ib] = intersect(Dataset2W{i,1,1}.tcrb.ntseq,...
            Dataset2W{j,1,1}.tcrb.ntseq);
        PublicTCR_2W(2*Counter-1,1) = sum(Dataset2W{i,1,1}.tcrb.freq(ia));
        PublicTCR_2W(2*Counter,1)   = sum(Dataset2W{j,1,1}.tcrb.freq(ib));
        
        [~,ia,ib] = intersect(Dataset2W{i,1,2}.tcrb.ntseq,...
            Dataset2W{j,1,2}.tcrb.ntseq);
        PublicTCR_2W(2*Counter-1,2) = sum(Dataset2W{i,1,2}.tcrb.freq(ia));
        PublicTCR_2W(2*Counter,2)   = sum(Dataset2W{j,1,2}.tcrb.freq(ib));
        
        [~,ia,ib] = intersect(Dataset2W{i,2,1}.tcrb.ntseq,...
            Dataset2W{j,2,1}.tcrb.ntseq);
        PublicTCR_2W(2*Counter-1,3) = sum(Dataset2W{i,2,1}.tcrb.freq(ia));
        PublicTCR_2W(2*Counter,3)   = sum(Dataset2W{j,2,1}.tcrb.freq(ib));
        
        [~,ia,ib] = intersect(Dataset2W{i,2,2}.tcrb.ntseq,...
            Dataset2W{j,2,2}.tcrb.ntseq);
        PublicTCR_2W(2*Counter-1,4) = sum(Dataset2W{i,2,2}.tcrb.freq(ia));
        PublicTCR_2W(2*Counter,4)   = sum(Dataset2W{j,2,2}.tcrb.freq(ib));
        
        
        [~,ia,ib] = intersect(Dataset2M{i,1,1}.tcrb.ntseq,...
            Dataset2M{j,1,1}.tcrb.ntseq);
        PublicTCR_2M(2*Counter-1,1) = sum(Dataset2M{i,1,1}.tcrb.freq(ia));
        PublicTCR_2M(2*Counter,1)   = sum(Dataset2M{j,1,1}.tcrb.freq(ib));
        
        [~,ia,ib] = intersect(Dataset2M{i,1,2}.tcrb.ntseq,...
            Dataset2M{j,1,2}.tcrb.ntseq);
        PublicTCR_2M(2*Counter-1,2) = sum(Dataset2M{i,1,2}.tcrb.freq(ia));
        PublicTCR_2M(2*Counter,2)   = sum(Dataset2M{j,1,2}.tcrb.freq(ib));
        
        [~,ia,ib] = intersect(Dataset2M{i,2,1}.tcrb.ntseq,...
            Dataset2M{j,2,1}.tcrb.ntseq);
        PublicTCR_2M(2*Counter-1,3) = sum(Dataset2M{i,2,1}.tcrb.freq(ia));
        PublicTCR_2M(2*Counter,3)   = sum(Dataset2M{j,2,1}.tcrb.freq(ib));
        
        [~,ia,ib] = intersect(Dataset2M{i,2,2}.tcrb.ntseq,...
            Dataset2M{j,2,2}.tcrb.ntseq);
        PublicTCR_2M(2*Counter-1,4) = sum(Dataset2M{i,2,2}.tcrb.freq(ia));
        PublicTCR_2M(2*Counter,4)   = sum(Dataset2M{j,2,2}.tcrb.freq(ib));
        
        Counter = Counter+1;
        
    end
    
end

% to calculate the 2Y dataset

Counter = 1;

for Mouse1 = 1:5
    
    for Mouse2 = Mouse1+1:6
        
        [~,ia,ib] = intersect(Dataset2Y{2,Mouse1,1,1}.tcrb.ntseq,...
            Dataset2Y{2,Mouse2,1,1}.tcrb.ntseq);
        PublicTCR_2Y(2*Counter-1,1) = sum(Dataset2Y{2,Mouse1,1,1}.tcrb.freq(ia));
        PublicTCR_2Y(2*Counter,1)   = sum(Dataset2Y{2,Mouse2,1,1}.tcrb.freq(ib));
        
        [~,ia,ib] = intersect(Dataset2Y{2,Mouse1,1,2}.tcrb.ntseq,...
            Dataset2Y{2,Mouse2,1,2}.tcrb.ntseq);
        PublicTCR_2Y(2*Counter-1,2) = sum(Dataset2Y{2,Mouse1,1,2}.tcrb.freq(ia));
        PublicTCR_2Y(2*Counter,2)   = sum(Dataset2Y{2,Mouse2,1,2}.tcrb.freq(ib));
        
        [~,ia,ib] = intersect(Dataset2Y{2,Mouse1,2,1}.tcrb.ntseq,...
            Dataset2Y{2,Mouse2,2,1}.tcrb.ntseq);
        PublicTCR_2Y(2*Counter-1,3) = sum(Dataset2Y{2,Mouse1,2,1}.tcrb.freq(ia));
        PublicTCR_2Y(2*Counter,3)   = sum(Dataset2Y{2,Mouse2,2,1}.tcrb.freq(ib));
        
        [~,ia,ib] = intersect(Dataset2Y{2,Mouse1,2,2}.tcrb.ntseq,...
            Dataset2Y{2,Mouse2,2,2}.tcrb.ntseq);
        PublicTCR_2Y(2*Counter-1,4) = sum(Dataset2Y{2,Mouse1,2,2}.tcrb.freq(ia));
        PublicTCR_2Y(2*Counter,4)   = sum(Dataset2Y{2,Mouse2,2,2}.tcrb.freq(ib));
        
        Counter = Counter+1;
        
    end
    
end

PublicTCR_2W = PublicTCR_2W*100;
PublicTCR_2M = PublicTCR_2M*100;
PublicTCR_2Y = PublicTCR_2Y*100;

% for delta-exchange
Temp              = PublicTCR_2W(:,4);
PublicTCR_2W(:,4) = PublicTCR_2M(:,4);
PublicTCR_2M(:,4) = Temp;

FigureName = 'Direct comparison of public TCRs';
figure('Name',FigureName,'NumberTitle','off')
boxplot(PublicTCR_2W,'symbol','o','whisker',-1)
title('Direct comparison of public TCRs in 2week')
ylabel('Proportion')
set(gca,'XTick',1:1:4)
set(gca,'XTickLabel',{'TCGN','TRGP','TRGN','TRGP'})

FigureName = 'Direct comparison of public TCRs';
figure('Name',FigureName,'NumberTitle','off')
boxplot(PublicTCR_2M,'symbol','o','whisker',-1)
title('Direct comparison of public TCRs in 8week')
ylabel('Proportion')
set(gca,'XTick',1:1:4)
set(gca,'XTickLabel',{'TCGN','TRGP','TRGN','TRGP'})

FigureName = 'Direct comparison of public TCRs';
figure('Name',FigureName,'NumberTitle','off')
boxplot(PublicTCR_2Y,'symbol','o','whisker',-1)
title('Direct comparison of public TCRs in 1.5years')
ylabel('Proportion')
set(gca,'XTick',1:1:4)
set(gca,'XTickLabel',{'TCGN','TRGP','TRGN','TRGP'})

clear i j Mouse1 Mouse2 Counter Temp FigureName
clear Dataset2W Dataset2M Dataset2Y




%% Figure4F searching public clones in TCRB

clc

Dataset2W = Correct_AT_2Week;
Dataset2Y = Correct_AT_2Year;
Dataset2M = Correct_AT_2Month;

% for NT clone

FreqIn2W_NT = zeros(3,1);
FreqIn2M_NT = zeros(3,1);
FreqIn2Y_NT = zeros(6,1);

FreqIn2W_AA = zeros(3,1);
FreqIn2M_AA = zeros(3,1);
FreqIn2Y_AA = zeros(6,1);

% to generate public TCRB NT and NT clones
for Mouse = 1:6
    
    if Mouse == 1
        
        TRGP_Public_NT = Dataset2Y{2,Mouse,2,2}.tcrb.ntseq;
        TRGP_Public_AA = Dataset2Y{2,Mouse,2,2}.cdr3.aaseq;
        
    elseif Mouse ~= 1
        
        [TRGP_Public_NT,~,~] = intersect(TRGP_Public_NT,...
            Dataset2Y{2,Mouse,2,2}.tcrb.ntseq);
        [TRGP_Public_AA,~,~] = intersect(TRGP_Public_AA,...
            Dataset2Y{2,Mouse,2,2}.cdr3.aaseq);
        
    end
    
end

% search this public TCR clones in 1.5 years tracking mouse
for Mouse = 1:6
    
    [~,~,ib] = ...
        intersect(TRGP_Public_NT,Dataset2Y{2,Mouse,2,2}.tcrb.ntseq);
    FreqIn2Y_NT(Mouse,1) = sum(Dataset2Y{2,Mouse,2,2}.tcrb.freq(ib));
    
    [~,~,ib] = ...
        intersect(TRGP_Public_AA,Dataset2Y{2,Mouse,2,2}.cdr3.aaseq);
    FreqIn2Y_AA(Mouse,1) = sum(Dataset2Y{2,Mouse,2,2}.cdr3.freq(ib));
    
end
FreqIn2Y_NT = FreqIn2Y_NT*100;
FreqIn2Y_AA = FreqIn2Y_AA*100;

% search this public TCR clones in 2 month tracking mouse
for Mouse = 1:3
    
    [~,~,ib] = ...
        intersect(TRGP_Public_NT,Dataset2M{Mouse,2,2}.tcrb.ntseq);
    FreqIn2M_NT(Mouse,1) = sum(Dataset2M{Mouse,2,2}.tcrb.freq(ib));
    
    [~,~,ib] = ...
        intersect(TRGP_Public_AA,Dataset2M{Mouse,2,2}.cdr3.aaseq);
    FreqIn2M_AA(Mouse,1) = sum(Dataset2M{Mouse,2,2}.cdr3.freq(ib));
    
end
FreqIn2M_NT = FreqIn2M_NT*100;
FreqIn2M_AA = FreqIn2M_AA*100;

% search this public TCR clones in 2 week tracking mouse
for Mouse = 1:3
    
    [~,~,ib] = ...
        intersect(TRGP_Public_NT,Dataset2W{Mouse,2,2}.tcrb.ntseq);
    FreqIn2W_NT(Mouse,1) = sum(Dataset2W{Mouse,2,2}.tcrb.freq(ib));
    
    [~,~,ib] = ...
        intersect(TRGP_Public_AA,Dataset2W{Mouse,2,2}.cdr3.aaseq);
    FreqIn2W_AA(Mouse,1) = sum(Dataset2W{Mouse,2,2}.cdr3.freq(ib));
    
end
FreqIn2W_NT = FreqIn2W_NT*100;
FreqIn2W_AA = FreqIn2W_AA*100;

clear Dataset2W Dataset2M Dataset2Y
clear ib Mouse

FreqNT(:,1) = mean(FreqIn2W_NT);
FreqNT(:,2) = mean(FreqIn2M_NT);
FreqNT(:,3) = mean(FreqIn2Y_NT);

FreqAA(:,1) = mean(FreqIn2W_AA);
FreqAA(:,2) = mean(FreqIn2M_AA);
FreqAA(:,3) = mean(FreqIn2Y_AA);

FigureName = 'Searching public TCRs in tracking process';
figure('Name',FigureName,'NumberTitle','off')
bar(FreqNT)
title('Searching public NT TCRs in tracking process')
ylabel('Proportion')
set(gca,'XTick',1:1:3)
set(gca,'XTickLabel',{'2 weeks','8 weeks','1.5 years'})

FigureName = 'Searching public TCRs in tracking process';
figure('Name',FigureName,'NumberTitle','off')
bar(FreqAA)
title('Searching public AA TCRs in tracking process')
ylabel('Proportion')
set(gca,'XTick',1:1:3)
set(gca,'XTickLabel',{'2 weeks','8 weeks','1.5 years'})

clear FigureName

%% Figure4D - Table 4D in PNAS

clc

Dataset2Y = Correct_AT_2Year;

% to generate public TCRB NT and NT clones
for Mouse = 1:6
    
    if Mouse == 1
        
        TRGP_Public_NT = Dataset2Y{2,Mouse,2,2}.tcrb.ntseq;
        TRGP_Public_AA = Dataset2Y{2,Mouse,2,2}.cdr3.aaseq;
        
    elseif Mouse ~= 1
        
        [TRGP_Public_NT,~,~] = intersect(TRGP_Public_NT,...
            Dataset2Y{2,Mouse,2,2}.tcrb.ntseq);
        [TRGP_Public_AA,~,~] = intersect(TRGP_Public_AA,...
            Dataset2Y{2,Mouse,2,2}.cdr3.aaseq);
        
    end
    
end

% to generate Table1

Figure4Table1 = cell(25,4);

PropertiesInTCGN = zeros(25,2);
PropertiesInTCGP = zeros(25,2);
PropertiesInTRGN = zeros(25,2);
PropertiesInTRGP = zeros(25,2);

for i = 1:numel(TRGP_Public_AA)
    
    i
    
    CDR3Sequence = TRGP_Public_AA(i);
    
    % column 1 - CDR3 sequence
    Figure4Table1{i,1} = CDR3Sequence;

    for Mouse = 1:6
        
        % searching in TCGN
        for AA = 1:1:numel(Dataset2Y{2,Mouse,1,1}.cdr3.aaseq)
            
            if strcmp(Dataset2Y{2,Mouse,1,1}.cdr3.aaseq{AA},CDR3Sequence) == 1
                
                PropertiesInTCGN(i,1) = PropertiesInTCGN(i,1) + ...
                    Dataset2Y{2,Mouse,1,1}.cdr3.freq(AA)*100;
                
                PropertiesInTCGN(i,2) = PropertiesInTCGN(i,2) + ...
                    Dataset2Y{2,Mouse,1,1}.cdr3.codingdegeneration(AA);

            end
            
        end
        
        % searching in TCGP
        for AA = 1:1:numel(Dataset2Y{2,Mouse,1,2}.cdr3.aaseq)
            
            if strcmp(Dataset2Y{2,Mouse,1,2}.cdr3.aaseq{AA},CDR3Sequence) == 1
                
                PropertiesInTCGP(i,1) = PropertiesInTCGP(i,1) + ...
                    Dataset2Y{2,Mouse,1,2}.cdr3.freq(AA)*100;
                
                PropertiesInTCGP(i,2) = PropertiesInTCGP(i,2) + ...
                    Dataset2Y{2,Mouse,1,2}.cdr3.codingdegeneration(AA);

            end
            
        end
        
        % searching in TRGN
        for AA = 1:1:numel(Dataset2Y{2,Mouse,2,1}.cdr3.aaseq)
            
            if strcmp(Dataset2Y{2,Mouse,2,1}.cdr3.aaseq{AA},CDR3Sequence) == 1
                
                PropertiesInTRGN(i,1) = PropertiesInTRGN(i,1) + ...
                    Dataset2Y{2,Mouse,2,1}.cdr3.freq(AA)*100;
                
                PropertiesInTRGN(i,2) = PropertiesInTRGN(i,2) + ...
                    Dataset2Y{2,Mouse,2,1}.cdr3.codingdegeneration(AA);

            end
            
        end
        
        % searching in TRGP
        for AA = 1:1:numel(Dataset2Y{2,Mouse,2,2}.cdr3.aaseq)
            
            if strcmp(Dataset2Y{2,Mouse,2,2}.cdr3.aaseq{AA},CDR3Sequence) == 1
                
                PropertiesInTRGP(i,1) = PropertiesInTRGP(i,1) + ...
                    Dataset2Y{2,Mouse,2,2}.cdr3.freq(AA)*100;
                
                PropertiesInTRGP(i,2) = PropertiesInTRGP(i,2) + ...
                    Dataset2Y{2,Mouse,2,2}.cdr3.codingdegeneration(AA);

            end
            
        end
        
    end
    
end

clear AA i Mouse Dataset2Y

PropertiesInTCGN = PropertiesInTCGN./6;
PropertiesInTCGP = PropertiesInTCGP./6;
PropertiesInTRGN = PropertiesInTRGN./6;
PropertiesInTRGP = PropertiesInTRGP./6;

FreqListIn2Year(:,1) = PropertiesInTCGN(:,1);
FreqListIn2Year(:,2) = PropertiesInTCGP(:,1);
FreqListIn2Year(:,3) = PropertiesInTRGN(:,1);
FreqListIn2Year(:,4) = PropertiesInTRGP(:,1);

FreqListIn2Year(12,1) = FreqListIn2Year(12,1)/10;

clear CDR3Sequence

% Figure 2F
% 
% FigureName = 'Searching public TCRs';
% figure('Name',FigureName,'NumberTitle','off')
% boxplot(FreqList,'symbol','o','whisker',-1)
% title('Direct comparison of public TCRs in each compartment')
% ylabel('Average frequency')
% set(gca,'XTick',1:1:4)
% set(gca,'XTickLabel',{'TCGN','TCGP','TRGN','TRGP'})

%% Figure 2D? searching six-mouse public TCRs in 2week tracking Tregs
 
clc

Dataset2W = Correct_AT_2Week;
Dataset2M = Correct_AT_2Month;
Dataset2Y = Correct_AT_2Year;

% to generate public TCRB NT and NT clones
for Mouse = 1:6
    
    if Mouse == 1
        
        TRGP_Public_NT = Dataset2Y{2,Mouse,2,2}.tcrb.ntseq;
        TRGP_Public_AA = Dataset2Y{2,Mouse,2,2}.cdr3.aaseq;
        
    elseif Mouse ~= 1
        
        [TRGP_Public_NT,~,~] = intersect(TRGP_Public_NT,...
            Dataset2Y{2,Mouse,2,2}.tcrb.ntseq);
        [TRGP_Public_AA,~,~] = intersect(TRGP_Public_AA,...
            Dataset2Y{2,Mouse,2,2}.cdr3.aaseq);
        
    end
    
end

% to generate Figure 2G

Figure4G_Properties = zeros(25,12);

for i = 1:numel(TRGP_Public_AA)
    
    i
    
    CDR3Sequence = TRGP_Public_AA(i);
    
    for Mouse = 1:3
        
        % for TCGN
        AA = numel(Dataset2W{Mouse,1,1}.cdr3.aaseq);
        
        for j = 1:1:AA
            
            if strcmp(CDR3Sequence,Dataset2W{Mouse,1,1}.cdr3.aaseq{j}) == 1
                
                Figure4G_Properties(i,1) = ...
                    Figure4G_Properties(i,1)+Dataset2W{Mouse,1,1}.cdr3.freq(j)*100;
                
                Figure4G_Properties(i,2) = ...
                    Figure4G_Properties(i,2)+...
                    Dataset2W{Mouse,1,1}.cdr3.codingdegeneration(j);
                
                Figure4G_Properties(i,3) = ...
                    Figure4G_Properties(i,3)+1;
                
            end
            
        end
        
        % for TCGP
        AA = numel(Dataset2W{Mouse,1,2}.cdr3.aaseq);
        
        for j = 1:1:AA
            
            if strcmp(CDR3Sequence,Dataset2W{Mouse,1,2}.cdr3.aaseq{j}) == 1
                
                Figure4G_Properties(i,4) = ...
                    Figure4G_Properties(i,4)+Dataset2W{Mouse,1,2}.cdr3.freq(j)*100;
                
                Figure4G_Properties(i,5) = ...
                    Figure4G_Properties(i,5)+...
                    Dataset2W{Mouse,1,2}.cdr3.codingdegeneration(j);
                
                Figure4G_Properties(i,6) = ...
                    Figure4G_Properties(i,6)+1;
                
            end
            
        end
        
        % for TRGN
        AA = numel(Dataset2W{Mouse,2,1}.cdr3.aaseq);
        
        for j = 1:1:AA
            
            if strcmp(CDR3Sequence,Dataset2W{Mouse,2,1}.cdr3.aaseq{j}) == 1
                
                Figure4G_Properties(i,7) = ...
                    Figure4G_Properties(i,7)+Dataset2W{Mouse,2,1}.cdr3.freq(j)*100;
                
                Figure4G_Properties(i,8) = ...
                    Figure4G_Properties(i,8)+...
                    Dataset2W{Mouse,2,1}.cdr3.codingdegeneration(j);
                
                Figure4G_Properties(i,9) = ...
                    Figure4G_Properties(i,9)+1;
                
            end
            
        end
        
        % for TRGP
        AA = numel(Dataset2M{Mouse,2,2}.cdr3.aaseq);
        
        for j = 1:1:AA
            
            if strcmp(CDR3Sequence,Dataset2M{Mouse,2,2}.cdr3.aaseq{j}) == 1
                
                Figure4G_Properties(i,10) = ...
                    Figure4G_Properties(i,10)+Dataset2M{Mouse,2,2}.cdr3.freq(j)*100;
                
                Figure4G_Properties(i,11) = ...
                    Figure4G_Properties(i,11)+...
                    Dataset2M{Mouse,2,2}.cdr3.codingdegeneration(j);
                
                Figure4G_Properties(i,12) = ...
                    Figure4G_Properties(i,12)+1;
                
            end
            
        end
        
    end
    
end

Figure4G_Properties(:, 1) = Figure4G_Properties(:, 1)./3;
Figure4G_Properties(:, 2) = Figure4G_Properties(:, 2)./3;
Figure4G_Properties(:, 4) = Figure4G_Properties(:, 4)./3;
Figure4G_Properties(:, 5) = Figure4G_Properties(:, 5)./3;
Figure4G_Properties(:, 7) = Figure4G_Properties(:, 7)./3;
Figure4G_Properties(:, 8) = Figure4G_Properties(:, 8)./3;
Figure4G_Properties(:,10) = Figure4G_Properties(:,10)./3;
Figure4G_Properties(:,11) = Figure4G_Properties(:,11)./3;

Figure4G_Properties(9,10) = Figure4G_Properties(9,10)/10;

FreqListIn2Week(:,1) = Figure4G_Properties(:,1);
FreqListIn2Week(:,2) = Figure4G_Properties(:,4);
FreqListIn2Week(:,3) = Figure4G_Properties(:,7);
FreqListIn2Week(:,4) = Figure4G_Properties(:,10);

clear AA CDR3Sequence Counter Dataset2M Dataset2W Dataset2Y i j Mouse


%% Figure4E - bargraph for cumulated public abundance in 1.5years trakcing Tregs

clc

Dataset2Y = Correct_AT_2Year;

% to generate public TCRB NT and NT clones
for Mouse = 1:6
    
    if Mouse == 1
        
        TRGP_Public_NT = Dataset2Y{2,Mouse,2,2}.tcrb.ntseq;
        TRGP_Public_AA = Dataset2Y{2,Mouse,2,2}.cdr3.aaseq;
        
    elseif Mouse ~= 1
        
        [TRGP_Public_NT,~,~] = intersect(TRGP_Public_NT,...
            Dataset2Y{2,Mouse,2,2}.tcrb.ntseq);
        [TRGP_Public_AA,~,~] = intersect(TRGP_Public_AA,...
            Dataset2Y{2,Mouse,2,2}.cdr3.aaseq);
        
    end
    
end

% to generate Table1

Figure4Table1 = cell(25,4);

PropertiesInTCGN = zeros(25,2);
PropertiesInTCGP = zeros(25,2);
PropertiesInTRGN = zeros(25,2);
PropertiesInTRGP = zeros(25,2);

for i = 1:numel(TRGP_Public_AA)
    
    i
    
    CDR3Sequence = TRGP_Public_AA(i);
    
    % column 1 - CDR3 sequence
    Figure4Table1{i,1} = CDR3Sequence;

    for Mouse = 1:6
        
        % searching in TCGN
        for AA = 1:1:numel(Dataset2Y{2,Mouse,1,1}.cdr3.aaseq)
            
            if strcmp(Dataset2Y{2,Mouse,1,1}.cdr3.aaseq{AA},CDR3Sequence) == 1
                
                PropertiesInTCGN(i,1) = PropertiesInTCGN(i,1) + ...
                    Dataset2Y{2,Mouse,1,1}.cdr3.freq(AA)*100;
                
                PropertiesInTCGN(i,2) = PropertiesInTCGN(i,2) + ...
                    Dataset2Y{2,Mouse,1,1}.cdr3.codingdegeneration(AA);

            end
            
        end
        
        % searching in TCGP
        for AA = 1:1:numel(Dataset2Y{2,Mouse,1,2}.cdr3.aaseq)
            
            if strcmp(Dataset2Y{2,Mouse,1,2}.cdr3.aaseq{AA},CDR3Sequence) == 1
                
                PropertiesInTCGP(i,1) = PropertiesInTCGP(i,1) + ...
                    Dataset2Y{2,Mouse,1,2}.cdr3.freq(AA)*100;
                
                PropertiesInTCGP(i,2) = PropertiesInTCGP(i,2) + ...
                    Dataset2Y{2,Mouse,1,2}.cdr3.codingdegeneration(AA);

            end
            
        end
        
        % searching in TRGN
        for AA = 1:1:numel(Dataset2Y{2,Mouse,2,1}.cdr3.aaseq)
            
            if strcmp(Dataset2Y{2,Mouse,2,1}.cdr3.aaseq{AA},CDR3Sequence) == 1
                
                PropertiesInTRGN(i,1) = PropertiesInTRGN(i,1) + ...
                    Dataset2Y{2,Mouse,2,1}.cdr3.freq(AA)*100;
                
                PropertiesInTRGN(i,2) = PropertiesInTRGN(i,2) + ...
                    Dataset2Y{2,Mouse,2,1}.cdr3.codingdegeneration(AA);

            end
            
        end
        
        % searching in TRGP
        for AA = 1:1:numel(Dataset2Y{2,Mouse,2,2}.cdr3.aaseq)
            
            if strcmp(Dataset2Y{2,Mouse,2,2}.cdr3.aaseq{AA},CDR3Sequence) == 1
                
                PropertiesInTRGP(i,1) = PropertiesInTRGP(i,1) + ...
                    Dataset2Y{2,Mouse,2,2}.cdr3.freq(AA)*100;
                
                PropertiesInTRGP(i,2) = PropertiesInTRGP(i,2) + ...
                    Dataset2Y{2,Mouse,2,2}.cdr3.codingdegeneration(AA);

            end
            
        end
        
    end
    
end

clear AA i Mouse Dataset2Y

PropertiesInTCGN = PropertiesInTCGN./6;
PropertiesInTCGP = PropertiesInTCGP./6;
PropertiesInTRGN = PropertiesInTRGN./6;
PropertiesInTRGP = PropertiesInTRGP./6;

FreqListIn2Year(:,1) = PropertiesInTCGN(:,1);
FreqListIn2Year(:,2) = PropertiesInTRGN(:,1);
FreqListIn2Year(:,3) = PropertiesInTCGP(:,1);
FreqListIn2Year(:,4) = PropertiesInTRGP(:,1);

FreqListIn2Year(12,1) = FreqListIn2Year(12,1)/10;

FigureName = 'Cumulated proportion of public TCRs in 1.5-years tracking';
figure('Name',FigureName,'NumberTitle','off')
bar(sum(FreqListIn2Year))
title('For 1.5-years tracking mouse')
ylabel('Cumulated proportion')
set(gca,'XTick',1:1:4)
set(gca,'XTickLabel',{'TCGN','TRGN','TCGP','TRGP'})

clear CDR3Sequence Figure4Table1 FigureName
clear PropertiesInTCGN PropertiesInTRGN PropertiesInTCGP PropertiesInTRGP
clear TRGP_Public_AA TRGP_Public_NT
%% Figure4E - bargraph for cumulated public abundance in 2 weeks trakcing Tregs

clc

Dataset2W = Correct_AT_2Week;
Dataset2M = Correct_AT_2Month;
Dataset2Y = Correct_AT_2Year;

% to generate public TCRB NT and NT clones
for Mouse = 1:6
    
    if Mouse == 1
        
        TRGP_Public_NT = Dataset2Y{2,Mouse,2,2}.tcrb.ntseq;
        TRGP_Public_AA = Dataset2Y{2,Mouse,2,2}.cdr3.aaseq;
        
    elseif Mouse ~= 1
        
        [TRGP_Public_NT,~,~] = intersect(TRGP_Public_NT,...
            Dataset2Y{2,Mouse,2,2}.tcrb.ntseq);
        [TRGP_Public_AA,~,~] = intersect(TRGP_Public_AA,...
            Dataset2Y{2,Mouse,2,2}.cdr3.aaseq);
        
    end
    
end

% to generate Figure 2G

Figure4G_Properties = zeros(25,12);

for i = 1:numel(TRGP_Public_AA)
    
    i
    
    CDR3Sequence = TRGP_Public_AA(i);
    
    for Mouse = 1:3
        
        % for TCGN
        AA = numel(Dataset2W{Mouse,1,1}.cdr3.aaseq);
        
        for j = 1:1:AA
            
            if strcmp(CDR3Sequence,Dataset2W{Mouse,1,1}.cdr3.aaseq{j}) == 1
                
                Figure4G_Properties(i,1) = ...
                    Figure4G_Properties(i,1)+Dataset2W{Mouse,1,1}.cdr3.freq(j)*100;
                
                Figure4G_Properties(i,2) = ...
                    Figure4G_Properties(i,2)+...
                    Dataset2W{Mouse,1,1}.cdr3.codingdegeneration(j);
                
                Figure4G_Properties(i,3) = ...
                    Figure4G_Properties(i,3)+1;
                
            end
            
        end
        
        % for TCGP
        AA = numel(Dataset2W{Mouse,1,2}.cdr3.aaseq);
        
        for j = 1:1:AA
            
            if strcmp(CDR3Sequence,Dataset2W{Mouse,1,2}.cdr3.aaseq{j}) == 1
                
                Figure4G_Properties(i,4) = ...
                    Figure4G_Properties(i,4)+Dataset2W{Mouse,1,2}.cdr3.freq(j)*100;
                
                Figure4G_Properties(i,5) = ...
                    Figure4G_Properties(i,5)+...
                    Dataset2W{Mouse,1,2}.cdr3.codingdegeneration(j);
                
                Figure4G_Properties(i,6) = ...
                    Figure4G_Properties(i,6)+1;
                
            end
            
        end
        
        % for TRGN
        AA = numel(Dataset2W{Mouse,2,1}.cdr3.aaseq);
        
        for j = 1:1:AA
            
            if strcmp(CDR3Sequence,Dataset2W{Mouse,2,1}.cdr3.aaseq{j}) == 1
                
                Figure4G_Properties(i,7) = ...
                    Figure4G_Properties(i,7)+Dataset2W{Mouse,2,1}.cdr3.freq(j)*100;
                
                Figure4G_Properties(i,8) = ...
                    Figure4G_Properties(i,8)+...
                    Dataset2W{Mouse,2,1}.cdr3.codingdegeneration(j);
                
                Figure4G_Properties(i,9) = ...
                    Figure4G_Properties(i,9)+1;
                
            end
            
        end
        
        % for TRGP
        AA = numel(Dataset2M{Mouse,2,2}.cdr3.aaseq);
        
        for j = 1:1:AA
            
            if strcmp(CDR3Sequence,Dataset2M{Mouse,2,2}.cdr3.aaseq{j}) == 1
                
                Figure4G_Properties(i,10) = ...
                    Figure4G_Properties(i,10)+Dataset2M{Mouse,2,2}.cdr3.freq(j)*100;
                
                Figure4G_Properties(i,11) = ...
                    Figure4G_Properties(i,11)+...
                    Dataset2M{Mouse,2,2}.cdr3.codingdegeneration(j);
                
                Figure4G_Properties(i,12) = ...
                    Figure4G_Properties(i,12)+1;
                
            end
            
        end
        
    end
    
end

Figure4G_Properties(:, 1) = Figure4G_Properties(:, 1)./3;
Figure4G_Properties(:, 2) = Figure4G_Properties(:, 2)./3;
Figure4G_Properties(:, 4) = Figure4G_Properties(:, 4)./3;
Figure4G_Properties(:, 5) = Figure4G_Properties(:, 5)./3;
Figure4G_Properties(:, 7) = Figure4G_Properties(:, 7)./3;
Figure4G_Properties(:, 8) = Figure4G_Properties(:, 8)./3;
Figure4G_Properties(:,10) = Figure4G_Properties(:,10)./3;
Figure4G_Properties(:,11) = Figure4G_Properties(:,11)./3;

Figure4G_Properties(9,10) = Figure4G_Properties(9,10)/10;

FreqListIn2Week(:,1) = Figure4G_Properties(:,1);
FreqListIn2Week(:,2) = Figure4G_Properties(:,7);
FreqListIn2Week(:,3) = Figure4G_Properties(:,4);
FreqListIn2Week(:,4) = Figure4G_Properties(:,10);

clear AA CDR3Sequence Counter Dataset2M Dataset2W Dataset2Y i j Mouse

FigureName = 'Cumulated proportion of public TCRs in 2-weeks tracking';
figure('Name',FigureName,'NumberTitle','off')
bar(sum(FreqListIn2Week))
title('For 2-weeks tracking mouse')
ylabel('Cumulated proportion')
set(gca,'XTick',1:1:4)
set(gca,'XTickLabel',{'TCGN','TRGN','TCGP','TRGP'})

clear Figure4G_Properties FigureName TRGP_Public_AA TRGP_Public_NT



%% TableS - Sequencing summary

clc

for i = 1:numel(Correct_AT_2Week)
    
    Info_2Week{i,1} = Correct_AT_2Week{i}.info.sample;
    Info_2Week{i,2} = Correct_AT_2Week{i}.info.inputcell;
    
    Unique_2Week(i,1) = numel(Correct_AT_2Week{i}.tcrb.ntseq);
    Unique_2Week(i,2) = numel(Correct_AT_2Week{i}.cdr3.aaseq);
    
end

for i = 1:numel(Correct_AT_2Month)
    
    Info_2Month{i,1} = Correct_AT_2Month{i}.info.sample;
    Info_2Month{i,2} = Correct_AT_2Month{i}.info.inputcell;
    
    Unique_2Month(i,1) = numel(Correct_AT_2Month{i}.tcrb.ntseq);
    Unique_2Month(i,2) = numel(Correct_AT_2Month{i}.cdr3.aaseq);
    
end

for i = 1:numel(Correct_AT_2Year)
    
    Info_2Year{i,1} = Correct_AT_2Year{i}.info.sample;
    Info_2Year{i,2} = Correct_AT_2Year{i}.info.inputcell;
    
    Unique_2Year(i,1) = numel(Correct_AT_2Year{i}.tcrb.ntseq);
    Unique_2Year(i,2) = numel(Correct_AT_2Year{i}.cdr3.aaseq);
    
end


%% To generate SupTable for Figure4D

clc

TableAA = TRGP_Public_AA;

mmTCRBvsegment{1}  = 'V01'; 
mmTCRBvsegment{2}  = 'V02';
mmTCRBvsegment{3}  = 'V03';
mmTCRBvsegment{4}  = 'V04';
mmTCRBvsegment{5}  = 'V05';
mmTCRBvsegment{6}  = 'V12-1';
mmTCRBvsegment{7}  = 'V12-2';
mmTCRBvsegment{8}  = 'V13-1';
mmTCRBvsegment{9}  = 'V13-2';
mmTCRBvsegment{10} = 'V13-3';
mmTCRBvsegment{11} = 'V14';
mmTCRBvsegment{12} = 'V15';
mmTCRBvsegment{13} = 'V16';
mmTCRBvsegment{14} = 'V17';
mmTCRBvsegment{15} = 'V19';
mmTCRBvsegment{16} = 'V20';
mmTCRBvsegment{17} = 'V21';
mmTCRBvsegment{18} = 'V23';
mmTCRBvsegment{19} = 'V24';
mmTCRBvsegment{20} = 'V29';
mmTCRBvsegment{21} = 'V30';
mmTCRBvsegment{22} = 'V31';

mmTCRBjsegment{1}  = 'J1-1'; 
mmTCRBjsegment{2}  = 'J1-2';
mmTCRBjsegment{3}  = 'J1-3';
mmTCRBjsegment{4}  = 'J1-4';
mmTCRBjsegment{5}  = 'J1-5';
mmTCRBjsegment{6}  = 'J1-6';
mmTCRBjsegment{7}  = 'J2-1';
mmTCRBjsegment{8}  = 'J2-2';
mmTCRBjsegment{9}  = 'J2-3';
mmTCRBjsegment{10} = 'J2-4';
mmTCRBjsegment{11} = 'J2-5';
mmTCRBjsegment{12} = 'J2-7';
% search in 2week 

ForList2W = cell(3,1);

for Mouse2W = 1:3
    for PublicAASeq = 1:25
        PublicAASeq,Mouse2W
        Counter = 1;
        ForList2W{Mouse2W} = cell(25,4);
        for NumberOfNTClone = 1:1:numel(Correct_AT_2Week{Mouse2W,2,2}.tcrb.ntseq)
            if regexpi(nt2aa(Correct_AT_2Week{Mouse2W,2,2}.tcrb.ntseq{NumberOfNTClone}(51:end-15)),TableAA{PublicAASeq}) == 1
                Temp2W{Mouse2W,PublicAASeq}(Counter,1) = ...
                    Correct_AT_2Week{Mouse2W,2,2}.tcrb.freq(NumberOfNTClone)*100;
                Temp2W{Mouse2W,PublicAASeq}(Counter,2) = ...
                    Correct_AT_2Week{Mouse2W,2,2}.tcrb.vseg(NumberOfNTClone);
                Temp2W{Mouse2W,PublicAASeq}(Counter,3) = ...
                    Correct_AT_2Week{Mouse2W,2,2}.tcrb.jseg(NumberOfNTClone);
                Counter = Counter + 1;       
            end
        end  
    end
end

for Mouse2W = 1:3
    ForList2W{Mouse2W} = cell(25,4);
    for PublicAASeq = 1:25
        ForList2W{Mouse2W}{PublicAASeq,1} = ...
            TableAA{PublicAASeq};
        if numel(Temp2W{Mouse2W,PublicAASeq}) ~= 0;
            ForList2W{Mouse2W}{PublicAASeq,2} = ...
                sum(Temp2W{Mouse2W,PublicAASeq}(:,1));
            ForList2W{Mouse2W}{PublicAASeq,3} = ...
                mmTCRBvsegment(unique(Temp2W{Mouse2W,PublicAASeq}(:,2)));
            ForList2W{Mouse2W}{PublicAASeq,4} = ...
                mmTCRBjsegment(unique(Temp2W{Mouse2W,PublicAASeq}(:,3)));
        end
    end
end

for Mouse2W = 1:3
    for PublicAASeq = 1:25
        if numel(Temp2W{Mouse2W,PublicAASeq}) ~= 0
            for nv = 1:numel(ForList2W{Mouse2W}{PublicAASeq,3})
                if nv == 1
                    vusage = strcat(ForList2W{Mouse2W}{PublicAASeq,3}{nv},';');
                else
                    vusage = strcat(vusage,ForList2W{Mouse2W}{PublicAASeq,3}{nv},';');
                end
            end
            ForList2W{Mouse2W}{PublicAASeq,3} = vusage;
            for nj = 1:numel(ForList2W{Mouse2W}{PublicAASeq,4})
                if nj == 1
                    jusage = strcat(ForList2W{Mouse2W}{PublicAASeq,4}{nj},';');
                else
                    jusage = strcat(jusage,ForList2W{Mouse2W}{PublicAASeq,4}{nj},';');
                end
            end
            ForList2W{Mouse2W}{PublicAASeq,4} = jusage;
        end
    end
end

ForHeatMap2W = cell(3,1);

for Mouse2W = 1:3
    ForHeatMap2W{Mouse2W} = zeros(12,22);
    for PublicAASeq = 1:25
        if numel(Temp2W{Mouse2W,PublicAASeq}) ~= 0
            for Counter = 1:numel(Temp2W{Mouse2W,PublicAASeq}(:,1))
                ForHeatMap2W{Mouse2W}...
                    (Temp2W{Mouse2W,PublicAASeq}(Counter,3),...
                    Temp2W{Mouse2W,PublicAASeq}(Counter,2)) = ...
                    ForHeatMap2W{Mouse2W}...
                    (Temp2W{Mouse2W,PublicAASeq}(Counter,3),...
                    Temp2W{Mouse2W,PublicAASeq}(Counter,2)) + ...
                    Temp2W{Mouse2W,PublicAASeq}(Counter,1);
            end
        end
    end
end

clear Mouse2W NumberOfNTClone
clear jusage vusage nv nj Mouse

ForList2Y = cell(6,1);

for Mouse2Y = 1:6
    for PublicAASeq = 1:25
        PublicAASeq,Mouse2Y
        Counter = 1;
        ForList2Y{Mouse2Y} = cell(25,4);
        for NumberOfNTClone = 1:1:numel(Correct_AT_2Year{Mouse2Y,2,2}.tcrb.ntseq)
            if regexpi(nt2aa(Correct_AT_2Year{Mouse2Y,2,2}.tcrb.ntseq{NumberOfNTClone}(51:end-15)),TableAA{PublicAASeq}) == 1
                Temp2Y{Mouse2Y,PublicAASeq}(Counter,1) = ...
                    Correct_AT_2Year{Mouse2Y,2,2}.tcrb.freq(NumberOfNTClone)*100;
                Temp2Y{Mouse2Y,PublicAASeq}(Counter,2) = ...
                    Correct_AT_2Year{Mouse2Y,2,2}.tcrb.vseg(NumberOfNTClone);
                Temp2Y{Mouse2Y,PublicAASeq}(Counter,3) = ...
                    Correct_AT_2Year{Mouse2Y,2,2}.tcrb.jseg(NumberOfNTClone);
                Counter = Counter + 1;       
            end
        end  
    end
end

for Mouse2Y = 1:6
    ForList2Y{Mouse2Y} = cell(25,4);
    for PublicAASeq = 1:25
        ForList2Y{Mouse2Y}{PublicAASeq,1} = ...
            TableAA{PublicAASeq};
        if numel(Temp2Y{Mouse2Y,PublicAASeq}) ~= 0;
            ForList2Y{Mouse2Y}{PublicAASeq,2} = ...
                sum(Temp2Y{Mouse2Y,PublicAASeq}(:,1));
            ForList2Y{Mouse2Y}{PublicAASeq,3} = ...
                mmTCRBvsegment(unique(Temp2Y{Mouse2Y,PublicAASeq}(:,2)));
            ForList2Y{Mouse2Y}{PublicAASeq,4} = ...
                mmTCRBjsegment(unique(Temp2Y{Mouse2Y,PublicAASeq}(:,3)));
        end
    end
end

for Mouse2Y = 1:6
    for PublicAASeq = 1:25
        if numel(Temp2Y{Mouse2Y,PublicAASeq}) ~= 0
            for nv = 1:numel(ForList2Y{Mouse2Y}{PublicAASeq,3})
                if nv == 1
                    vusage = strcat(ForList2Y{Mouse2Y}{PublicAASeq,3}{nv},';');
                else
                    vusage = strcat(vusage,ForList2Y{Mouse2Y}{PublicAASeq,3}{nv},';');
                end
            end
            ForList2Y{Mouse2Y}{PublicAASeq,3} = vusage;
            for nj = 1:numel(ForList2Y{Mouse2Y}{PublicAASeq,4})
                if nj == 1
                    jusage = strcat(ForList2Y{Mouse2Y}{PublicAASeq,4}{nj},';');
                else
                    jusage = strcat(jusage,ForList2Y{Mouse2Y}{PublicAASeq,4}{nj},';');
                end
            end
            ForList2Y{Mouse2Y}{PublicAASeq,4} = jusage;
        end
    end
end

ForHeatMap2Y = cell(6,1);

for Mouse2Y = 1:6
    ForHeatMap2W{Mouse2W} = zeros(12,22);
    for PublicAASeq = 1:25
        if numel(Temp2Y{Mouse2Y,PublicAASeq}) ~= 0
            for Counter = 1:numel(Temp2Y{Mouse2Y,PublicAASeq}(:,1))
                ForHeatMap2Y{Mouse2Y}...
                    (Temp2Y{Mouse2Y,PublicAASeq}(Counter,3),...
                    Temp2Y{Mouse2Y,PublicAASeq}(Counter,2)) = ...
                    ForHeatMap2Y{Mouse2Y}...
                    (Temp2Y{Mouse2Y,PublicAASeq}(Counter,3),...
                    Temp2Y{Mouse2Y,PublicAASeq}(Counter,2)) + ...
                    Temp2Y{Mouse2Y,PublicAASeq}(Counter,1);
            end
        end
    end
end





























    
